{% extends "base.html" %}
{% block content %}

<div class="max-w-7xl mx-auto mt-2 p-4">
    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
        <div>
            <h1 class="text-3xl font-bold text-yellow-500 leading-tight">ðŸ“‚ Registri Sistema Completi</h1>
            <p class="text-xs text-gray-500 font-medium">Monitoraggio movimenti e archivio documentale riservato</p>
        </div>

        <div class="flex gap-2">
            <input type="date" id="globalDateFilter" onchange="filterByDate(this.value)"
                class="border rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-yellow-400 outline-none shadow-sm">
            <a href="{{ url_for('esporta_pdf_audit') }}" id="btn-esporta"
                class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition text-sm shadow-md font-bold self-start md:self-center">
                ðŸ“„ Esporta Solo Movimenti
            </a>
        </div>
    </div>

    <div class="flex space-x-4 mb-6 border-b overflow-x-auto bg-white p-2 rounded-t-xl">
        <button onclick="switchTab('op')" id="btn-op"
            class="py-2 px-4 border-b-2 border-green-500 text-green-600 font-bold whitespace-nowrap flex items-center gap-2 transition-all">
            <i class="fas fa-boxes text-xs"></i> Movimenti Merce
        </button>
        <button onclick="switchTab('pdf')" id="btn-pdf"
            class="py-2 px-4 border-b-2 border-transparent text-gray-500 hover:text-blue-600 whitespace-nowrap flex items-center gap-2 transition-all">
            <i class="fas fa-file-download text-xs"></i> Download Report
        </button>
        <button onclick="switchTab('doc')" id="btn-doc"
            class="py-2 px-4 border-b-2 border-transparent text-gray-500 hover:text-purple-600 whitespace-nowrap flex items-center gap-2 transition-all">
            <i class="fas fa-archive text-xs"></i> AttivitÃ  Archivio
        </button>
        <button onclick="switchTab('admin')" id="btn-admin"
            class="py-2 px-4 border-b-2 border-transparent text-gray-500 hover:text-red-600 whitespace-nowrap flex items-center gap-2 transition-all">
            <i class="fas fa-user-shield text-xs"></i> Log Admin (IP)
        </button>
    </div>

    <div id="tab-op" class="tab-content bg-white shadow-lg rounded-xl overflow-hidden border">
        <table class="w-full text-sm text-left datatable">
            <thead class="bg-gray-800 text-white font-bold uppercase text-[11px]">
                <tr>
                    <th class="p-4">Data</th>
                    <th class="p-4">Prodotto</th>
                    <th class="p-4 text-center">Tipo</th>
                    <th class="p-4 text-center">Q.tÃ </th>
                    <th class="p-4">Dettaglio</th>
                </tr>
            </thead>
            <tbody class="divide-y text-gray-700">
                {% for mov in logs_movimenti %}
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="p-4 text-gray-500 italic text-xs">{{ mov[0].strftime('%d/%m/%Y %H:%M') }}</td>
                    <td class="p-4 font-bold text-gray-800">{{ mov[1] }}</td>
                    <td class="p-4 text-center">
                        <span
                            class="px-2 py-1 rounded text-[10px] font-bold uppercase {% if mov[2]=='entrata' %}bg-green-100 text-green-700{% else %}bg-red-100 text-red-700{% endif %}">
                            {% if mov[2]=='entrata' %}â†‘ Entrata{% else %}â†“ Uscita{% endif %}
                        </span>
                    </td>
                    <td class="p-4 text-center font-mono font-bold">{{ mov[3] }}</td>
                    <td class="p-4 text-xs text-gray-600">{{ mov[4] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div id="tab-pdf" class="tab-content hidden bg-white shadow-lg rounded-xl overflow-hidden border">
        <table class="w-full text-sm text-left datatable">
            <thead class="bg-gray-800 text-white font-bold uppercase text-[11px]">
                <tr>
                    <th class="p-4">Data</th>
                    <th class="p-4">Utente</th>
                    <th class="p-4">Report</th>
                    <th class="p-4">Filtro</th>
                </tr>
            </thead>
            <tbody class="divide-y text-gray-700">
                {% for log in logs_pdf %}
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="p-4 text-gray-500 italic text-xs">{{ log[3].strftime('%d/%m/%Y %H:%M') if log[3] else
                        'N.D.' }}</td>
                    <td class="p-4 font-bold text-blue-600">{{ log[0] }}</td>
                    <td class="p-4 uppercase text-xs">{{ log[1] }}</td>
                    <td class="p-4">{{ log[2] or 'Completo' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div id="tab-doc" class="tab-content hidden space-y-6 animate-fade-in">
        <div
            class="flex flex-col md:flex-row gap-4 items-center justify-between bg-white p-4 rounded-xl shadow-sm border border-purple-100">
            <div class="relative flex-1 w-full">
                <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                <input type="text" id="docSearch" placeholder="Cerca titolo, categoria o utente..."
                    class="w-full p-2.5 pl-10 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-400 outline-none"
                    onkeyup="filterDocs()">
            </div>
            <button onclick="toggleFormDocumenti()"
                class="bg-green-600 text-white px-6 py-2.5 rounded-lg font-bold shadow-md hover:bg-green-700 transition flex items-center gap-2 justify-center w-full md:w-auto">
                <i class="fas fa-file-medical"></i> Nuovo Caricamento
            </button>
        </div>

        <div id="container-crea" class="hidden bg-white p-6 rounded-xl shadow-lg border-t-4 border-green-500 relative">
            <button onclick="toggleFormDocumenti()" class="absolute top-4 right-4 text-gray-400 hover:text-red-500">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h2 class="text-lg font-bold mb-4 text-gray-800 flex items-center gap-2">
                <i class="fas fa-upload text-green-600"></i> Allega Documenti ai Registri
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                <div>
                    <label class="block text-xs font-black text-gray-500 mb-1 uppercase">Titolo</label>
                    <input type="text" id="titolo_multiplo" class="w-full border rounded-lg p-2 text-sm"
                        placeholder="Es: Registri 2026">
                </div>
                <div>
                    <label class="block text-xs font-black text-gray-500 mb-1 uppercase">Categoria</label>
                    <select id="categoria_doc" class="w-full border rounded-lg p-2 text-sm bg-white font-medium">
                        <option value="Generale">Generale</option>
                        <option value="Fatture">Fatture</option>
                        <option value="Certificazioni">Certificazioni</option>
                        <option value="Lotti">Lotti</option>
                        <option value="Trasporto">Trasporto</option>
                        <option value="Antincendio">Antincendio</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-black text-gray-500 mb-1 uppercase">File</label>
                    <input type="file" id="file_input_hidden" multiple class="hidden"
                        onchange="handleFileSelection(this)">
                    <button type="button" onclick="document.getElementById('file_input_hidden').click()"
                        class="w-full bg-gray-50 border-2 border-dashed border-gray-300 p-2 rounded-lg text-gray-600 hover:border-green-400 transition text-sm font-bold">
                        <i class="fas fa-paperclip"></i> Allega File
                    </button>
                    <div id="file-list-accumulated" class="mt-2 space-y-1"></div>
                </div>
                <button type="button" onclick="uploadTutto()"
                    class="bg-blue-600 text-white px-6 py-2.5 rounded-lg hover:bg-blue-700 font-bold shadow-md">
                    Avvia Upload
                </button>
            </div>
            <div id="progressContainer" class="hidden mt-4 bg-gray-100 p-3 rounded-lg">
                <div class="w-full bg-gray-300 rounded-full h-2">
                    <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all" style="width: 0%"></div>
                </div>
                <p id="progressPercent" class="text-center text-[10px] font-bold text-blue-700 mt-1 uppercase">0%</p>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="bg-purple-50 p-3 border-b font-bold text-purple-800 text-sm flex items-center gap-2">
                <i class="fas fa-folder-open text-purple-600"></i> Documenti Disponibili
            </div>
            <table class="w-full text-left" id="docTable">
                <thead class="bg-gray-800 text-white font-bold uppercase text-[11px]">
                    <tr>
                        <th class="p-4">Data</th>
                        <th class="p-4">Titolo e Categoria</th>
                        <th class="p-4">File Allegati</th>
                        <th class="p-4">Operatore</th>
                        <th class="p-4 text-right">Azioni</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-100">
                    {% for doc in documenti %}
                    <tr class="hover:bg-gray-50 transition">
                        <td class="p-4 text-xs text-gray-500 italic">{{ doc[1].strftime('%d/%m/%Y %H:%M') if doc[1] else
                            '---' }}</td>
                        <td class="p-4">
                            <div class="font-bold text-gray-800">{{ doc[0] }}</div>
                            <span
                                class="text-[10px] bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full uppercase font-black">{{
                                doc[4] }}</span>
                        </td>
                        <td class="p-4">
                            <div class="flex flex-wrap gap-2">
                                {% for file in doc[3] %}
                                <button onclick="gestisciAnteprima(this)"
                                    data-url="{{ url_for('static', filename='uploads/documenti/' + file) }}"
                                    data-ext="{{ file.split('.')[-1].lower() }}"
                                    class="flex items-center gap-2 bg-white border border-gray-200 p-1.5 px-3 rounded-lg text-xs font-bold hover:shadow-md hover:border-purple-400 transition">
                                    <i class="fas fa-file-pdf text-red-500"></i>
                                    <span class="truncate max-w-[150px]">{{ file.split('_')[-1] }}</span>
                                </button>
                                {% endfor %}
                            </div>
                        </td>
                        <td class="p-4 text-xs font-bold text-gray-600">{{ doc[2] }}</td>
                        <td class="p-4 text-right">
                            <button onclick="eliminaGruppo('{{ doc[0] }}', '{{ doc[1] }}')"
                                class="text-gray-400 hover:text-red-600 p-2">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" class="p-12 text-center text-gray-400 italic">Nessun documento in archivio</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div id="tab-admin" class="tab-content hidden bg-white shadow-lg rounded-xl overflow-hidden border">
        <table class="w-full text-sm text-left datatable">
            <thead class="bg-red-800 text-white font-bold uppercase text-[11px]">
                <tr>
                    <th class="p-4">Data</th>
                    <th class="p-4">Utente / IP</th>
                    <th class="p-4">Azione</th>
                    <th class="p-4">Dettaglio / Dispositivo</th>
                </tr>
            </thead>
            <tbody class="divide-y text-gray-700">
                {% for log in logs_op %}
                <tr class="hover:bg-red-50">
                    <td class="p-4 text-gray-500 italic text-xs">{{ log[3].strftime('%d/%m/%Y %H:%M') if log[3] else
                        'N.D.' }}</td>
                    <td class="p-4">
                        <div class="font-bold text-red-600">{{ log[0] }}</div>
                        <div class="text-[10px] text-gray-400 font-mono italic">{{ log[4] or '0.0.0.0' }}</div>
                    </td>
                    <td class="p-4">
                        <span
                            class="px-2 py-1 rounded text-[10px] font-bold uppercase {% if 'ELIMINA' in log[1] %} bg-red-100 text-red-700 {% elif 'NUOVO' in log[1] %} bg-green-100 text-green-700 {% else %} bg-blue-100 text-blue-700 {% endif %}">
                            {{ log[1] }}
                        </span>
                    </td>
                    <td class="p-4">
                        <div class="text-xs font-bold text-gray-800 mb-1 leading-relaxed">
                            {{ log[2] }}
                        </div>

                        <div class="flex flex-wrap gap-1.5 mt-2">
                            {% if log[5] %}
                            {# Piccola logica inline per le icone #}
                            {% set ua = log[5]|lower %}
                            <span
                                class="text-[9px] bg-white text-gray-600 px-2 py-0.5 rounded-md flex items-center gap-1.5 border border-gray-300 shadow-sm"
                                title="{{ log[5] }}">
                                {% if 'android' in ua or 'iphone' in ua %}
                                <i class="fas fa-mobile-alt text-blue-500"></i>
                                {% elif 'windows' in ua %}
                                <i class="fab fa-windows text-blue-400"></i>
                                {% elif 'macintosh' in ua %}
                                <i class="fab fa-apple text-gray-800"></i>
                                {% else %}
                                <i class="fas fa-laptop text-gray-400"></i>
                                {% endif %}

                                {# Mostra il brand/os in modo leggibile #}
                                <span class="font-medium">
                                    {% if 'android' in ua %}Android{% elif 'iphone' in ua %}iPhone{% elif 'windows' in
                                    ua %}Windows{% elif 'macintosh' in ua %}Mac{% else %}Dispositivo{% endif %}
                                </span>

                                <span class="text-gray-300">|</span>

                                {# Taglia la stringa UA per non rompere il layout #}
                                <span class="italic">{{ log[5][:30] }}...</span>
                            </span>
                            {% endif %}

                            <span
                                class="text-[9px] bg-red-50 text-red-600 px-2 py-0.5 rounded-md border border-red-100 font-bold">
                                <i class="fas fa-hashtag text-[8px] opacity-70"></i> EVT-{{ loop.revindex }}
                            </span>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function filterByDate(dateStr) {
        if (!dateStr) return;
        const formattedDate = dateStr.split('-').reverse().join('/'); // trasforma yyyy-mm-dd in dd/mm/yyyy
        const tables = document.querySelectorAll('.datatable tbody');

        tables.forEach(tbody => {
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => {
                const dateCell = row.cells[0].innerText;
                row.style.display = dateCell.includes(formattedDate) ? '' : 'none';
            });
        });
    }

</script>

<script>

    let fileBuffer = [];

    // --- LOGICA TAB --// -
    function switchTab(tab) {
        const sections = { 'op': 'tab-op', 'pdf': 'tab-pdf', 'doc': 'tab-doc', 'admin': 'tab-admin' };
        const buttons = { 'op': 'btn-op', 'pdf': 'btn-pdf', 'doc': 'btn-doc', 'admin': 'btn-admin' };
        // Dentro switchTab(tab)
        const borderColors = { 'op': 'green-500', 'pdf': 'blue-500', 'doc': 'purple-500', 'admin': 'red-500' };
        const textColors = { 'op': 'green-600', 'pdf': 'blue-600', 'doc': 'purple-600', 'admin': 'red-600' };
        const bgColors = { 'op': 'bg-green-600', 'pdf': 'bg-blue-600', 'doc': 'bg-purple-600', 'admin': 'bg-red-800' };

        // 1. Configurazione inclusa la tab admin (per evitare il crash)
        const config = {
            'op': { color: 'emerald', text: 'ðŸ“„ Esporta Registro Movimenti', url: "{{ url_for('esporta_pdf_audit') }}" },
            'pdf': { color: 'blue', text: 'ðŸ“„ Esporta Registro Download', url: "{{ url_for('esporta_pdf') }}" },
            'doc': { color: 'purple', text: 'ðŸ“„ Esporta Log Archivio', url: "{{ url_for('esporta_log_archivio') }}" },
            'admin': { color: 'purple', text: 'ðŸ“„ Esporta Log Admin', url: "#" } // Aggiunto per evitare errore
        };

        // 2. Nascondi tutte le sezioni (con controllo di esistenza)
        Object.values(sections).forEach(id => {
            const el = document.getElementById(id);
            if (el) el.classList.add('hidden');
        });

        // 3. Resetta i bottoni (con controllo di esistenza)
        Object.keys(buttons).forEach(key => {
            const btn = document.getElementById(buttons[key]);
            if (btn) btn.className = "py-2 px-4 border-b-2 border-transparent text-gray-400 hover:text-gray-600 font-medium whitespace-nowrap transition-all";
        });

        // 4. Mostra sezione attiva
        const targetSection = document.getElementById(sections[tab]);
        if (targetSection) targetSection.classList.remove('hidden');

        // 5. Colora il bottone attivo
        const activeBtn = document.getElementById(buttons[tab]);
        if (activeBtn) {
            const borderColors = { 'op': 'emerald-500', 'pdf': 'blue-500', 'doc': 'purple-500', 'admin': 'purple-600' };
            const textColors = { 'op': 'emerald-600', 'pdf': 'blue-600', 'doc': 'purple-600', 'admin': 'purple-700' };
            activeBtn.className = `py-2 px-4 border-b-2 border-${borderColors[tab]} text-${textColors[tab]} font-bold whitespace-nowrap transition-all`;
        }

        // 6. Aggiorna il pulsante di esportazione (solo se esiste e se Ã¨ configurato)
        const btnEsp = document.getElementById('btn-esporta');
        if (btnEsp && config[tab]) {
            btnEsp.innerText = config[tab].text;
            btnEsp.href = config[tab].url;
            const bgColors = { 'op': 'bg-emerald-600', 'pdf': 'bg-blue-600', 'doc': 'bg-purple-600', 'admin': 'bg-gray-800' };
            btnEsp.className = `${bgColors[tab]} text-white px-4 py-2 rounded-lg hover:opacity-90 transition text-sm shadow-md font-bold self-start md:self-center`;
        }
    }

    function uploadTutto() {
        const titolo = document.getElementById('titolo_multiplo').value;
        const categoria = document.getElementById('categoria_doc').value;
        if (!titolo) return alert("Inserisci un titolo");
        if (fileBuffer.length === 0) return alert("Allega almeno un file");

        const formData = new FormData();
        formData.append("titolo", titolo);
        formData.append("categoria", categoria);
        fileBuffer.forEach(file => formData.append("file_allegato", file));

        const xhr = new XMLHttpRequest();

        // CONTROLLO DI SICUREZZA:
        const pContainer = document.getElementById('progressContainer');
        if (pContainer) {
            pContainer.classList.remove('hidden');
        }

        xhr.upload.onprogress = (e) => {
            if (e.lengthComputable) {
                const percent = Math.round((e.loaded / e.total) * 100);
                // Altro controllo di sicurezza per la barra
                const pBar = document.getElementById('progressBar');
                const pText = document.getElementById('progressPercent');
                if (pBar) pBar.style.width = percent + "%";
                if (pText) pText.innerText = percent + "%";
            }
        };

        xhr.onload = () => {
            if (xhr.status === 200) {
                alert("Caricamento completato con successo!");
                location.reload();
            } else {
                alert("Errore durante l'upload: " + xhr.responseText);
            }
        };

        xhr.open("POST", "{{ url_for('documenti_view') }}", true);
        xhr.send(formData);
    }

    // --- LOGICA UI ---
    function toggleFormDocumenti() {
        document.getElementById('container-crea').classList.toggle('hidden');
    }

    function toggleCronologia() {
        const crono = document.getElementById('container-cronologia');
        crono.classList.toggle('hidden');
        if (!crono.classList.contains('hidden')) {
            setTimeout(() => {
                crono.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }, 100);
        }
    }

    // --- LOGICA CARICAMENTO ---
    function handleFileSelection(input) {
        Array.from(input.files).forEach(file => {
            if (!fileBuffer.some(f => f.name === file.name)) fileBuffer.push(file);
        });
        input.value = "";
        aggiornaListaAnteprima();
    }

    function aggiornaListaAnteprima() {
        const container = document.getElementById('file-list-accumulated');
        container.innerHTML = fileBuffer.map((f, i) => `
            <div class="flex items-center justify-between bg-purple-50 p-1 px-2 rounded border border-purple-100 text-[10px] animate-fade-in">
                <span class="truncate"><i class="fas fa-paperclip text-purple-400"></i> ${f.name}</span>
                <button onclick="fileBuffer.splice(${i},1);aggiornaListaAnteprima()" class="text-red-400 font-bold px-1 hover:text-red-600">Ã—</button>
            </div>
        `).join('');
    }

    function uploadTutto() {
        const titolo = document.getElementById('titolo_multiplo').value;
        const categoria = document.getElementById('categoria_doc').value;
        if (!titolo) return alert("Inserisci un titolo");
        if (fileBuffer.length === 0) return alert("Allega almeno un file");

        const formData = new FormData();
        formData.append("titolo", titolo);
        formData.append("categoria", categoria);
        fileBuffer.forEach(file => formData.append("file_allegato", file));

        const xhr = new XMLHttpRequest();
        document.getElementById('progressContainer').classList.remove('hidden');

        xhr.upload.onprogress = (e) => {
            if (e.lengthComputable) {
                const percent = Math.round((e.loaded / e.total) * 100);
                document.getElementById('progressBar').style.width = percent + "%";
                document.getElementById('progressPercent').innerText = percent + "%";
            }
        };

        xhr.onload = () => { if (xhr.status === 200) location.reload(); else alert("Errore durante l'upload"); };
        xhr.open("POST", "{{ url_for('documenti_view') }}", true);
        xhr.send(formData);
    }

    // --- LOGICA ANTEPRIMA E LOGGING ---
    function gestisciAnteprima(elemento) {
        const url = elemento.getAttribute('data-url');
        const ext = elemento.getAttribute('data-ext');
        const riga = elemento.closest('tr');
        const titoloDoc = riga.querySelector('.font-bold.text-gray-800').innerText;
        const nomeFile = url.split('/').pop();

        // 1. LOG DI APERTURA ANTEPRIMA
        inviaLogArchivio(titoloDoc, nomeFile, "ANTEPRIMA");

        const content = document.getElementById('previewContent');
        const btnDl = document.getElementById('btnDownloadModal');

        // 2. LOG DI DOWNLOAD (Quando clicca il tasto nel modal)
        btnDl.onclick = () => {
            inviaLogArchivio(titoloDoc, nomeFile, "DOWNLOAD");
            window.open(url, '_blank');
        };

        content.innerHTML = '';
        if (ext === 'pdf') {
            content.innerHTML = `<iframe src="${url}" class="w-full h-full border-none"></iframe>`;
        } else if (['jpg', 'jpeg', 'png'].includes(ext)) {
            content.innerHTML = `<img src="${url}" class="max-w-full max-h-full object-contain" />`;
        } else {
            content.innerHTML = `<p class="text-gray-500">Anteprima non disponibile per .${ext.toUpperCase()}</p>`;
        }

        document.getElementById('modalPreview').classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    // Funzione di supporto per evitare ripetizioni di codice
    function inviaLogArchivio(titolo, file, tipoAzione) {
        fetch("/documenti/log_stampa", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                titolo: titolo,
                file: file,
                azione: tipoAzione // Passiamo il tipo di azione qui
            })
        }).catch(err => console.error("Errore log:", err));
    }

    function chiudiAnteprima() {
        document.getElementById('modalPreview').classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    function apriModalModifica(btn) {
        const nome = btn.getAttribute('data-nome');
        const categoria = btn.getAttribute('data-categoria');

        // Popola i campi
        document.getElementById('edit_vecchio_nome').value = nome;
        document.getElementById('edit_nuovo_nome').value = nome;

        // Gestione categoria (se non esiste nel select, imposta Generale)
        const selectCat = document.getElementById('edit_categoria');
        selectCat.value = categoria || 'Generale';

        // Mostra il modal
        const modal = document.getElementById('modalModifica');
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden'; // Blocca scroll
    }

    function chiudiModal() {
        document.getElementById('modalModifica').classList.add('hidden');
        document.body.style.overflow = 'auto'; // Riattiva scroll
    }

    function eliminaGruppo(titolo, dataISO) {
        if (confirm(`Eliminare definitivamente il gruppo "${titolo}"?`)) {
            const fd = new FormData();
            fd.append("titolo", titolo);
            fd.append("data", dataISO);
            fetch("/documenti/elimina_gruppo", { method: 'POST', body: fd }).then(r => { if (r.ok) location.reload(); });
        }
    }

    function filterDocs() {
        let input = document.getElementById("docSearch").value.toLowerCase();
        let rows = document.querySelectorAll("#docTable tbody tr");
        rows.forEach(row => row.style.display = row.innerText.toLowerCase().includes(input) ? "" : "none");
    }
</script>

<style>
    /* IL POSTO GIUSTO Ãˆ QUESTO */
    footer {
        display: none !important;
    }

    .animate-fade-in {
        animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(5px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

<style>
    .animate-fade-in {
        animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(5px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}